@plugin "@tailwindcss/typography";

@layer base {
  /* ===== Override default Tailwind Typography styles ===== */
  .app-prose {
    @apply prose;

    h1,
    h2,
    h3,
    h4,
    th {
      @apply mb-3 text-foreground;
    }

    h3 {
      @apply font-sriracha italic;
    }

    p,
    strong,
    ol,
    ul,
    figcaption,
    table,
    code {
      @apply text-foreground;
    }

    a {
      @apply relative font-medium text-foreground no-underline transition-all duration-200 wrap-break-word;
      background-image: linear-gradient(to right, color-mix(in srgb, var(--accent) 40%, transparent), color-mix(in srgb, var(--accent) 40%, transparent));
      background-position: 0 100%;
      background-size: 100% 1px;
      background-repeat: no-repeat;
    }

    a:hover,
    a:focus-visible {
      @apply text-accent outline-none;
      background-size: 100% 2px;
      background-image: linear-gradient(to right, var(--accent), var(--accent));
    }

    ul {
      @apply overflow-x-clip;
    }

    li {
      @apply marker:text-accent;
    }

    hr {
      @apply border-border;
    }

    img {
      @apply mx-auto border border-border;
    }

    figcaption {
      @apply opacity-75;
    }

    table {
      @apply w-full table-auto border-collapse;

      th,
      td {
        @apply border border-border p-2;
        word-wrap: break-word;
        word-break: break-word;
        hyphens: auto;
        overflow-wrap: break-word;
      }

      th {
        @apply py-1.5;
      }

      code {
        @apply break-all sm:break-normal;
      }
    }

    code {
      @apply rounded-md bg-muted/15 px-1.5 py-0.5 wrap-break-word font-cartograph text-sm text-foreground shadow-sm shadow-black/5 before:content-none after:content-none;
    }

    .astro-code code {
      @apply flex-[1_0_100%] bg-inherit p-0;
    }

    blockquote {
      @apply rounded-r-xl border-s-[3px] border-accent/80 bg-accent/5 py-4 pr-5 pl-6 font-sriracha text-[1.05rem] text-foreground/90 opacity-90 shadow-sm shadow-accent/5 wrap-break-word;
    }

    /* ===== Table of Contents (modern card) ===== */
    details {
      @apply block w-full cursor-pointer rounded-2xl border border-border/20 bg-muted/5 text-foreground backdrop-blur-sm transition-all duration-300 ease-in-out select-none hover:border-accent/25 hover:shadow-lg hover:shadow-accent/5 [&_p]:hidden [&_ul]:my-0!;
    }

    details[open] {
      @apply border-accent/20 bg-muted/8 shadow-md shadow-accent/5;
    }

    summary {
      @apply flex list-none items-center gap-2 px-4 py-3 font-cartograph text-sm font-medium tracking-wide text-foreground transition-colors duration-200 hover:text-accent focus-visible:no-underline focus-visible:outline-2 focus-visible:outline-offset-1 focus-visible:outline-accent focus-visible:outline-dashed;
    }

    summary:hover::before,
    summary:hover::after {
      background-color: var(--accent);
    }

    summary::-webkit-details-marker {
      display: none;
    }

    summary::before {
      content: "";
      display: inline-block;
      width: 18px;
      height: 18px;
      flex-shrink: 0;
      -webkit-mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='18' height='18' viewBox='0 0 24 24' fill='none' stroke='black' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cline x1='3' y1='6' x2='21' y2='6'/%3E%3Cline x1='3' y1='12' x2='15' y2='12'/%3E%3Cline x1='3' y1='18' x2='18' y2='18'/%3E%3C/svg%3E");
      mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='18' height='18' viewBox='0 0 24 24' fill='none' stroke='black' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cline x1='3' y1='6' x2='21' y2='6'/%3E%3Cline x1='3' y1='12' x2='15' y2='12'/%3E%3Cline x1='3' y1='18' x2='18' y2='18'/%3E%3C/svg%3E");
      -webkit-mask-size: contain;
      mask-size: contain;
      -webkit-mask-repeat: no-repeat;
      mask-repeat: no-repeat;
      background-color: var(--foreground);
      opacity: 0.55;
      transition:
        opacity 0.2s,
        background-color 0.2s;
    }

    details[open] > summary::before {
      background-color: var(--accent);
      opacity: 0.8;
    }

    summary::after {
      content: "";
      display: inline-block;
      width: 14px;
      height: 14px;
      flex-shrink: 0;
      margin-left: auto;
      -webkit-mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='14' height='14' viewBox='0 0 24 24' fill='none' stroke='black' stroke-width='2.5' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'/%3E%3C/svg%3E");
      mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='14' height='14' viewBox='0 0 24 24' fill='none' stroke='black' stroke-width='2.5' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'/%3E%3C/svg%3E");
      -webkit-mask-size: contain;
      mask-size: contain;
      -webkit-mask-repeat: no-repeat;
      mask-repeat: no-repeat;
      background-color: var(--foreground);
      opacity: 0.45;
      transition:
        transform 0.3s cubic-bezier(0.4, 0, 0.2, 1),
        opacity 0.2s,
        background-color 0.2s;
    }

    details[open] > summary::after {
      transform: rotate(180deg);
      background-color: var(--accent);
      opacity: 0.7;
    }

    /* TOC inner list container */
    details > ul {
      @apply relative mx-0 mt-0 mb-0 border-t border-border/15 px-4 pt-2 pb-3;
    }

    details > ul > li {
      @apply relative list-none py-0.5;
    }

    details > ul li {
      @apply list-none;
    }

    details > ul li a {
      @apply relative inline-flex items-center gap-1.5 rounded-lg px-2.5 py-1 font-cartograph text-[13px] text-foreground/85 no-underline transition-all duration-200 hover:bg-accent/8 hover:text-accent hover:no-underline;
      background-image: none !important;
    }

    details > ul li a::before {
      content: "";
      display: inline-block;
      width: 6px;
      height: 6px;
      border-radius: 50%;
      flex-shrink: 0;
      background: color-mix(in srgb, var(--accent) 50%, transparent);
      transition: all 0.2s;
    }

    details > ul li a:hover::before {
      background: var(--accent);
      box-shadow: 0 0 8px color-mix(in srgb, var(--accent) 40%, transparent);
    }

    /* Nested list (sub-items) */
    details > ul ul {
      @apply my-0 ml-3 border-l-2 border-accent/15 pl-2;
    }

    details > ul ul li a {
      @apply text-[12px] text-foreground/70;
    }

    details > ul ul li a::before {
      width: 4px;
      height: 4px;
      background: color-mix(in srgb, var(--accent) 35%, transparent);
    }

    details > ul ul li a:hover::before {
      background: color-mix(in srgb, var(--accent) 70%, transparent);
    }

    pre {
      @apply focus-visible:border-transparent focus-visible:outline-2 focus-visible:outline-accent focus-visible:outline-dashed;
    }
  }

  /* ===== Code Blocks & Syntax Highlighting ===== */
  .astro-code,
  code {
    @apply font-cartograph;
  }

  .astro-code {
    @apply flex border bg-(--shiki-light-bg) text-(--shiki-light) outline-border [&_span]:text-(--shiki-light);
  }

  html[data-theme="dark"] .astro-code {
    @apply bg-(--shiki-dark-bg) text-(--shiki-dark) [&_span]:text-(--shiki-dark);
  }

  /* Styles for Shiki transformers */
  /* https://shiki.style/packages/transformers */
  .astro-code {
    .line.diff.add {
      @apply relative inline-block w-full bg-green-400/20 before:absolute before:-left-3 before:text-green-500 before:content-['+'];
    }
    .line.diff.remove {
      @apply relative inline-block w-full bg-red-500/20 before:absolute before:-left-3 before:text-red-500 before:content-['-'];
    }
    .line.highlighted {
      @apply inline-block w-full bg-slate-400/20;
    }
    .highlighted-word {
      @apply rounded-sm border border-border px-0.5 py-px;
    }
  }
}
